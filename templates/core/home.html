{% load static i18n md %}
<!doctype html>
<html lang="{{ request.LANGUAGE_CODE }}">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>UniHanko</title>
    <link rel="icon" href="{% static 'img/unihanko-mark.svg' %}">
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2/css/pico.min.css">
    <script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>
    <style>
        :root{
          --uh-accent:#ff8a3d;
          --uh-accent-hover:#ffb074;
          --pico-font-size:105%;
          --footer-h: 260px;
        }
        html, body { height: 100%; margin: 0; overflow-x: hidden; }
        body{ background:#0f1216; }
        a{ color:var(--uh-accent); text-decoration-color:var(--uh-accent); text-underline-offset:2px; }
        a:hover{ color:var(--uh-accent-hover); text-decoration-color:var(--uh-accent-hover); }
        /* a:visited{ color:var(--uh-accent); text-decoration-color:var(--uh-accent); } */
        a:focus-visible{ outline:2px solid var(--uh-accent); outline-offset:2px; border-radius:4px; }
        .muted{ opacity:.8; }
    
        /* Top-right flags */
        .lang-switcher{ position:fixed; top:12px; right:16px; z-index:50; display:flex; gap:8px; align-items:center; }
        .flag-btn{ display:inline-flex; align-items:center; justify-content:center; background:transparent; border:1px solid transparent; padding:4px; border-radius:8px; cursor:pointer; }
        .flag-btn:hover{ background:rgba(255,255,255,.06); }
        .flag-btn.active{ outline:2px solid var(--uh-accent); outline-offset:2px; }
        .flag{ width:28px; height:20px; display:block; border-radius:2px; box-shadow:0 0 0 1px rgba(255,255,255,.12) inset; }
        .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
    
        /* Main + Lottie */
        main{ min-height: calc(100dvh - var(--footer-h)); position: relative; padding: 2rem 1.25rem 1rem;  /* slightly tighter padding */ }
        #lottie-bg{ position:absolute; inset:0; pointer-events:none; z-index:0; opacity:.28; filter:saturate(.95) contrast(1.05); }
        .wrap{ max-width:1100px; margin:0 auto; position:relative; z-index:1; }
    
        /* Masthead pinned top-left */
        .masthead{ display:flex; gap:1.25rem; align-items:center; margin-bottom:0; }
        .masthead-logo{ width:86px; height:86px; border-radius:14px; box-shadow:0 4px 22px rgba(0,0,0,.35); background:rgba(255,255,255,.03); display:grid; place-items:center; overflow:hidden; }
        .masthead-logo img{ width:84px; height:auto; }
        .masthead-text h1{ margin:0; }
        .masthead-text p{ margin:.25rem 0 0; }
    
        /* CTA stage – centers independently of masthead */
        .cta-stage{
          min-height:42vh;            /* gives real space to center inside viewport */
          display:grid;
          place-items:center;
          margin-top:0.75rem;         /* tiny breathing room below masthead */
        }
        .cta-grid{ display:flex; gap:1.25rem; justify-content:center; flex-wrap:wrap; }
    
        /* CTA cards */
        .cta-card{
          --card-bg:rgba(255,255,255,.02);
          position:relative;
          width:240px; height:200px;
          display:flex; flex-direction:column; align-items:center; justify-content:center;
          border:5px solid var(--uh-accent);          /* thicker border */
          border-radius:0;                             /* square corners */
          background:var(--card-bg);
          text-decoration:none; color:#eaeaf0;
          transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
          box-shadow:0 10px 24px rgba(0,0,0,.25), inset 0 0 0 3px rgba(255,138,61,.35); /* inner border */
        }
        .cta-card:hover{
          transform:translateY(-2px) scale(1.03);
          box-shadow:0 16px 36px rgba(0,0,0,.35), inset 0 0 0 3px rgba(255,138,61,.45);
          border-color:var(--uh-accent-hover);
        }
        .cta-card::before{
          content:""; position:absolute; inset:0; border-radius:inherit;
          background:linear-gradient(110deg, transparent 0%, rgba(255,255,255,.08) 18%, rgba(255,255,255,.22) 20%, transparent 22%, transparent 55%, rgba(255,255,255,.10) 58%, rgba(255,255,255,.18) 60%, transparent 62%, transparent 100%);
          background-size:240% 100%; opacity:0; pointer-events:none;
        }
        .cta-card:hover::before{ opacity:1; animation:streak 1600ms ease-out 1 forwards; }
        @keyframes streak{ from{background-position:-120% 0;} to{background-position:120% 0;} }
    
        .cta-emoji{ font-size:58px; line-height:1; margin-bottom:.45rem; }
        .cta-label{ font-weight:700; letter-spacing:.2px; }
    
        /* Footer */
        footer.site-footer{ border-top:1px solid rgba(255,255,255,.06); padding:2.2rem 1rem; }
        .site-footer .container{ max-width:1100px; margin:0 auto; }
        .footer-grid{ display:grid; gap:2rem; grid-template-columns:1.2fr 1fr 1fr; }
        .brand h2{ margin:0 0 .5rem 0; }
        .brand-title{ display:flex; align-items:center; gap:.5rem; }
        .brand-title .oeh-logo{ height:38px; width:auto; opacity:1; }
        .list{ list-style:square; padding-left:1.2rem; margin:.5rem 0 0; }
        .list li{ margin:.25rem 0; }
        .site-footer .list a{ color:var(--uh-accent); text-decoration-color:var(--uh-accent); }
        .tech-logos{ display:flex; gap:.6rem; align-items:center; flex-wrap:wrap; margin-top:.35rem; }
        .tech-logos img{ height:22px; width:auto; display:block; }
        .tech-badge{ display:inline-flex; align-items:center; padding:.18rem .55rem; border:1px solid var(--uh-accent); border-radius:.5rem; font-weight:600; font-size:.9rem; line-height:1; color:var(--uh-accent); text-decoration:none; }
        .tech-badge:hover{ background:rgba(255,138,61,.10); border-color:var(--uh-accent-hover); color:var(--uh-accent-hover); }
        .tech-badge:focus-visible{ outline:2px solid var(--uh-accent); outline-offset:2px; border-radius:.5rem; }
    
        @media (max-width:920px){
          .footer-grid{ grid-template-columns:1fr; }
          .cta-card{ width:220px; height:180px; }
          .cta-stage{ min-height:42vh; }
        }
    
        /* --- Modal styling --- */
        dialog.modal {
        width: min(820px, 92vw);
        max-height: 75vh;
        padding: 0;                     /* we'll pad inner wrapper */
        background: #111518;
        color: #eaeaf0;
        border: 4px solid var(--uh-accent);
        border-radius: 0;               /* square corners */
        box-shadow: 0 20px 60px rgba(0,0,0,.55);
        overflow: hidden;               /* inner scroll lives inside content */
        }
        dialog.modal::backdrop {
        background: rgba(0,0,0,.55);
        backdrop-filter: blur(1px);
        }
    
        /* header (title + close X) */
        .modal-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: .75rem;
        padding: .9rem 1rem;
        border-bottom: 1px solid rgba(255,255,255,.08);
        }
        .modal-head h3 { margin: 0; }
        /* Close button: white tile + red X */
        .modal-close{
        display:inline-flex; align-items:center; justify-content:center;
        width:36px; height:36px;
        background:#fff;
        color:#b91c1c;                 /* red text (the ×) */
        border:2px solid #b91c1c;
        border-radius:6px;
        cursor:pointer;
        font-size:1.2rem; line-height:1;
        }
        .modal-close:hover{
        background:#fee2e2;            /* light red */
        border-color:#7f1d1d;
        color:#7f1d1d;
        }
        /* Mini flags inside modal header */
        .modal-head .mini-lang { display:flex; gap:6px; align-items:center; }
        .modal-head .mini-lang .flag { width:22px; height:16px; border-radius:2px; box-shadow:none; }
        .modal-head .mini-lang .flag-btn{ padding:2px; border-radius:6px; border:1px solid transparent; }
        .modal-head .mini-lang .flag-btn:hover{ background:rgba(255,255,255,.06); }
    
        /* content area with inner scroll */
        .modal-body {
        padding: 1rem 1.25rem 1.25rem;
        max-height: calc(75vh - 58px); /* 58px ≈ header height */
        overflow: auto;
        }

        /* GitHub badge (pill) */
        .gh-badge{
        display:inline-flex; align-items:center; gap:.4rem;
        margin-left:.5rem; padding:.15rem .55rem;
        border:1px solid var(--uh-accent); border-radius:.5rem;
        font-weight:600; font-size:.85rem; line-height:1;
        color:var(--uh-accent); text-decoration:none; vertical-align:middle;
        }
        .gh-badge:hover{
        background: rgba(255,138,61,.10);
        border-color: var(--uh-accent-600);
        color: var(--uh-accent-600);
        }
        .gh-badge svg{ width:16px; height:16px; fill: currentColor; }
    </style>
</head>

<body>
    <!-- Flags -->
    <div class="lang-switcher">
        {% with code=request.LANGUAGE_CODE|slice:":2" %}
        <form method="post" action="{% url 'set_language' %}">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            <input type="hidden" name="language" value="en">
            <button type="submit" class="flag-btn {% if code == 'en' %}active{% endif %}" aria-label="Switch to English">
                <span class="sr-only">English</span>
                <svg class="flag" viewBox="0 0 60 40" aria-hidden="true">
                    <rect width="60" height="40" fill="#012169" />
                    <path d="M0,0 60,40 M60,0 0,40" stroke="#fff" stroke-width="8" />
                    <path d="M0,0 60,40 M60,0 0,40" stroke="#C8102E" stroke-width="4" />
                    <rect x="26" width="8" height="40" fill="#fff" />
                    <rect y="16" width="60" height="8" fill="#fff" />
                    <rect x="28" width="4" height="40" fill="#C8102E" />
                    <rect y="18" width="60" height="4" fill="#C8102E" />
                </svg>
            </button>
        </form>
        <form method="post" action="{% url 'set_language' %}">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            <input type="hidden" name="language" value="de">
            <button type="submit" class="flag-btn {% if code == 'de' %}active{% endif %}" aria-label="Deutsch (Österreich)">
                <span class="sr-only">Deutsch</span>
                <svg class="flag" viewBox="0 0 3 2" aria-hidden="true">
                    <rect width="3" height="2" fill="#ED2939" />
                    <rect y="0.6667" width="3" height="0.6667" fill="#FFFFFF" />
                </svg>
            </button>
        </form>
        {% endwith %}
    </div>

    <main>
        <div id="lottie-bg"></div>
        <div class="wrap">
            <!-- Masthead (top-left) -->
            <div class="masthead">
                <div class="masthead-logo"><img src="{% static 'img/unihanko-logo.svg' %}" alt="UniHanko"></div>
                <div class="masthead-text">
                    <h1>{% trans "Welcome to" %} <span style="color: #ff8a3d;">UniHanko</span></h1>
                    <h2>{% trans "UAS Upper Austria" %}</h2>
                </div>
            </div>

            <!-- CTA stage (center/center) -->
            <section class="cta-stage">
                <div class="cta-grid" role="list">
                    <a href="/admin/" class="cta-card" role="listitem" aria-label="{% trans 'Back Office' %}">
                        <div class="cta-emoji" aria-hidden="true">🗂️</div>
                        <div class="cta-label">{% trans "Back Office" %}</div>
                    </a>
                    <a href="/filer/" class="cta-card" role="listitem" aria-label="{% trans 'Public ECTS Filing' %}">
                        <div class="cta-emoji" aria-hidden="true">📮</div>
                        <div class="cta-label">{% trans "Public ECTS Filing" %}</div>
                    </a>
                </div>
            </section>
        </div>
    </main>

    <!-- About / Technical Info -->
    <dialog id="modal-about" class="modal" aria-labelledby="modal-about-title">
        <div class="modal-head">
            <h3 id="modal-about-title">{% trans "Technical Info" %}</h3>

            <div class="mini-lang">
                {% with code=request.LANGUAGE_CODE|slice:":2" %}
                <!-- EN -->
                <form method="post" action="{% url 'set_language' %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <input type="hidden" name="language" value="en">
                    <button type="submit" class="flag-btn {% if code == 'en' %}active{% endif %}" aria-label="English">
                        <svg class="flag" viewBox="0 0 60 40" aria-hidden="true">
                            <rect width="60" height="40" fill="#012169" />
                            <path d="M0,0 60,40 M60,0 0,40" stroke="#fff" stroke-width="8" />
                            <path d="M0,0 60,40 M60,0 0,40" stroke="#C8102E" stroke-width="4" />
                            <rect x="26" width="8" height="40" fill="#fff" />
                            <rect y="16" width="60" height="8" fill="#fff" />
                            <rect x="28" width="4" height="40" fill="#C8102E" />
                            <rect y="18" width="60" height="4" fill="#C8102E" />
                        </svg>
                    </button>
                </form>
                <!-- AT -->
                <form method="post" action="{% url 'set_language' %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <input type="hidden" name="language" value="de">
                    <button type="submit" class="flag-btn {% if code == 'de' %}active{% endif %}" aria-label="Deutsch">
                        <svg class="flag" viewBox="0 0 3 2" aria-hidden="true">
                            <rect width="3" height="2" fill="#ED2939" />
                            <rect y="0.6667" width="3" height="0.6667" fill="#FFFFFF" />
                        </svg>
                    </button>
                </form>
                {% endwith %}

                <button type="button" class="modal-close" aria-label="{% trans 'Close' %}">×</button>
            </div>
        </div>
        <div class="modal-body">
            {% if flat_about %}{{ flat_about.content|markdown }}{% else %} {% include "pages/_about.inc.html" %}{% endif %}
        </div>
    </dialog>

    <!-- Privacy / Legal -->
    <dialog id="modal-privacy" class="modal" aria-labelledby="modal-privacy-title">
        <div class="modal-head">
            <h3 id="modal-about-title">{% trans "Legal" %}</h3>

            <div class="mini-lang">
                {% with code=request.LANGUAGE_CODE|slice:":2" %}
                <!-- EN -->
                <form method="post" action="{% url 'set_language' %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <input type="hidden" name="language" value="en">
                    <button type="submit" class="flag-btn {% if code == 'en' %}active{% endif %}" aria-label="English">
                        <svg class="flag" viewBox="0 0 60 40" aria-hidden="true">
                            <rect width="60" height="40" fill="#012169" />
                            <path d="M0,0 60,40 M60,0 0,40" stroke="#fff" stroke-width="8" />
                            <path d="M0,0 60,40 M60,0 0,40" stroke="#C8102E" stroke-width="4" />
                            <rect x="26" width="8" height="40" fill="#fff" />
                            <rect y="16" width="60" height="8" fill="#fff" />
                            <rect x="28" width="4" height="40" fill="#C8102E" />
                            <rect y="18" width="60" height="4" fill="#C8102E" />
                        </svg>
                    </button>
                </form>
                <!-- AT -->
                <form method="post" action="{% url 'set_language' %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <input type="hidden" name="language" value="de">
                    <button type="submit" class="flag-btn {% if code == 'de' %}active{% endif %}" aria-label="Deutsch">
                        <svg class="flag" viewBox="0 0 3 2" aria-hidden="true">
                            <rect width="3" height="2" fill="#ED2939" />
                            <rect y="0.6667" width="3" height="0.6667" fill="#FFFFFF" />
                        </svg>
                    </button>
                </form>
                {% endwith %}

                <button type="button" class="modal-close" aria-label="{% trans 'Close' %}">×</button>
            </div>
        </div>
        <div class="modal-body">
            {% if flat_privacy %}{{ flat_privacy.content|markdown }}{% else %} {% include "pages/_privacy.inc.html" %}{% endif %}
        </div>
    </dialog>

    <!-- Contact -->
    <dialog id="modal-contact" class="modal" aria-labelledby="modal-contact-title">
        <div class="modal-head">
            <h3 id="modal-about-title">{% trans "Contact" %}</h3>

            <div class="mini-lang">
                {% with code=request.LANGUAGE_CODE|slice:":2" %}
                <!-- EN -->
                <form method="post" action="{% url 'set_language' %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <input type="hidden" name="language" value="en">
                    <button type="submit" class="flag-btn {% if code == 'en' %}active{% endif %}" aria-label="English">
                        <svg class="flag" viewBox="0 0 60 40" aria-hidden="true">
                            <rect width="60" height="40" fill="#012169" />
                            <path d="M0,0 60,40 M60,0 0,40" stroke="#fff" stroke-width="8" />
                            <path d="M0,0 60,40 M60,0 0,40" stroke="#C8102E" stroke-width="4" />
                            <rect x="26" width="8" height="40" fill="#fff" />
                            <rect y="16" width="60" height="8" fill="#fff" />
                            <rect x="28" width="4" height="40" fill="#C8102E" />
                            <rect y="18" width="60" height="4" fill="#C8102E" />
                        </svg>
                    </button>
                </form>
                <!-- AT -->
                <form method="post" action="{% url 'set_language' %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <input type="hidden" name="language" value="de">
                    <button type="submit" class="flag-btn {% if code == 'de' %}active{% endif %}" aria-label="Deutsch">
                        <svg class="flag" viewBox="0 0 3 2" aria-hidden="true">
                            <rect width="3" height="2" fill="#ED2939" />
                            <rect y="0.6667" width="3" height="0.6667" fill="#FFFFFF" />
                        </svg>
                    </button>
                </form>
                {% endwith %}

                <button type="button" class="modal-close" aria-label="{% trans 'Close' %}">×</button>
            </div>
        </div>
        <div class="modal-body">
            {% if flat_contact %}{{ flat_contact.content|markdown }}{% else %} {% include "pages/_contact.inc.html" %}{% endif %}
        </div>
    </dialog>


    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <section class="brand">
                    <div class="brand-title">
                        <h2>UniHanko {% trans "for" %}</h2>
                        <a href="https://oeh.fh-ooe.at" target="_blank" rel="noopener" aria-label="To the FH OÖ"><img class="oeh-logo" src="{% static 'img/unihanko-mark.svg' %}" alt="ÖH"></a>
                    </div>

                    <p class="muted">
                        © Sven Várszegi
                        <a class="gh-badge" href="https://github.com/oehfhooe-assistenz/unihanko-django" target="_blank" rel="noopener" aria-label="View the project on GitHub">
                            <!-- GitHub mark (inline SVG, no external asset needed) -->
                            <svg viewBox="0 0 16 16" aria-hidden="true">
                                <path d="M8 0C3.58 0 0 3.58 0 8a8 8 0 0 0 5.47 7.59c.4.07.55-.17.55-.38
                        0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52
                        -.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07
                        -1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21
                        2.2.82a7.62 7.62 0 0 1 2-.27c.68 0 1.36.09 2 .27 1.53-1.03 2.2-.82 2.2-.82.44 1.1.16
                        1.92.08 2.12.51.56.82 1.28.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48
                        0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8 8 0 0 0 16 8c0-4.42-3.58-8-8-8Z" />
                            </svg>
                            <span>GitHub</span>
                        </a>
                    </p>

                    <p class="muted">
                        {% trans "Built with" %} ❤️ {% trans "using" %} Django, Jazzmin &amp; PicoCSS
                    </p>

                    <div class="tech-logos">
                        <a href="https://www.djangoproject.com/" aria-label="Django">
                            <img src="{% static 'img/vendor/django.svg' %}" alt="Django">
                        </a>
                        <a href="https://github.com/farridav/django-jazzmin" class="tech-badge" aria-label="Jazzmin">Jazzmin</a>
                        <a href="https://picocss.com/" aria-label="PicoCSS">
                            <img src="{% static 'img/vendor/pico.svg' %}" alt="PicoCSS">
                        </a>
                    </div>
                </section>
                <section>
                    <h3>{% trans "Info & Policies" %}</h3>
                    <ul class="list">
                        <li><a href="/pages/about/" data-modal="about">{% trans "Technical Info" %}</a></li>
                        <li><a href="/pages/privacy/" data-modal="privacy">{% trans "Legal" %}</a></li>
                    </ul>
                </section>
                <section>
                    <h3>{% trans "Contact & Support" %}</h3>
                    <ul class="list">
                        <li><a href="/pages/contact/" data-modal="contact">{% trans "Email us" %}</a></li>
                        <li><a href="#" rel="noopener">{% trans "Buy me a coffee :)" %}</a></li>
                    </ul>
                </section>
            </div>
        </div>
    </footer>

    <script>
        (function(){
          const container = document.getElementById('lottie-bg');
          if (!container || !window.lottie) return;
          // Swap to your CDN or local file if needed:
          const ANIM_URL = "static/anim/bubbles.json";
          window.lottie.loadAnimation({ container, renderer:'svg', loop:true, autoplay:true, path:ANIM_URL });
        })();
    </script>

    <script>
        // Open/close helpers for <dialog> modals, no Alpine needed.
          (function () {
            const html = document.documentElement;
        
            function openModal(id) {
              const dlg = document.getElementById(id);
              if (!dlg || typeof dlg.showModal !== "function") return;
              dlg.showModal();
              html.style.overflow = "hidden";          // prevent background scroll
            }
            function closeModal(dlg) {
              dlg.close();
              html.style.overflow = "";                // restore scroll
            }
        
            // Wire footer links with data-modal="about|privacy|contact"
            document.addEventListener("click", function (e) {
              const a = e.target.closest('a[data-modal]');
              if (!a) return;
              e.preventDefault();
              const id = 'modal-' + a.getAttribute('data-modal');
              openModal(id);
            });
        
            // Close handlers for X buttons and Esc
            document.querySelectorAll("dialog.modal").forEach(dlg => {
              dlg.addEventListener("close", () => (html.style.overflow = ""));
              // Allow clicking the X
              dlg.querySelectorAll(".modal-close").forEach(btn => {
                btn.addEventListener("click", () => closeModal(dlg));
              });
              // Optional: click outside to close
              dlg.addEventListener("click", (ev) => {
                const rect = dlg.getBoundingClientRect();
                const inside = ev.clientX >= rect.left && ev.clientX <= rect.right &&
                               ev.clientY >= rect.top && ev.clientY <= rect.bottom;
                if (!inside) closeModal(dlg);
              });
            });
          })();
    </script>

</body>

</html>