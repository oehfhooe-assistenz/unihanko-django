{% extends "portal/base.html" %}
{% load i18n %}

{% block content %}
<h1 class="page-title">{% trans "Complete Payment Plan" %}</h1>

<div class="card">
    <h2 class="card-title">{{ payment_plan.plan_code }}</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-top: 1rem;">
        <div>
            <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 0.25rem;">{% trans "Role" %}</p>
            <p style="font-weight: 600;">{{ payment_plan.person_role.role.name }}</p>
        </div>
        <div>
            <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 0.25rem;">{% trans "Fiscal Year" %}</p>
            <p style="font-weight: 600;">{{ payment_plan.fiscal_year.label }}</p>
        </div>
        <div>
            <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 0.25rem;">{% trans "Monthly Amount" %}</p>
            <p style="font-weight: 600; color: #FF6B35;">â‚¬ {{ payment_plan.monthly_amount }}</p>
        </div>
    </div>
</div>

<form method="post">
    {% csrf_token %}

    <div class="card">
        <h2 class="card-title">{% trans "Banking Details" %}</h2>
        <p style="color: #94a3b8; margin-bottom: 1.5rem;">
            {% trans "Please enter your banking information. This will be used to process payments for this role." %}
        </p>

        <div class="form-group">
            <label for="id_payee_name" class="form-label">{{ form.payee_name.label }}</label>
            {{ form.payee_name }}
            {% if form.payee_name.errors %}
                <ul class="errorlist">
                    {% for error in form.payee_name.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if form.payee_name.help_text %}
                <span class="form-help">{{ form.payee_name.help_text }}</span>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="id_iban" class="form-label">{{ form.iban.label }}</label>
            {{ form.iban }}
            {% if form.iban.errors %}
                <ul class="errorlist">
                    {% for error in form.iban.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if form.iban.help_text %}
                <span class="form-help">{{ form.iban.help_text }}</span>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="id_bic" class="form-label">{{ form.bic.label }}</label>
            {{ form.bic }}
            {% if form.bic.errors %}
                <ul class="errorlist">
                    {% for error in form.bic.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if form.bic.help_text %}
                <span class="form-help">{{ form.bic.help_text }}</span>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="id_address" class="form-label">{{ form.address.label }}</label>
            {{ form.address }}
            {% if form.address.errors %}
                <ul class="errorlist">
                    {% for error in form.address.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if form.address.help_text %}
                <span class="form-help">{{ form.address.help_text }}</span>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="id_reference" class="form-label">{{ form.reference.label }}</label>
            {{ form.reference }}
            {% if form.reference.errors %}
                <ul class="errorlist">
                    {% for error in form.reference.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if form.reference.help_text %}
                <span class="form-help">{{ form.reference.help_text }}</span>
            {% endif %}
        </div>
    </div>

    {% if disclaimer %}
    <div class="card">
        <h2 class="card-title">{% trans "Disclaimer" %}</h2>

        <div style="background: #2a2a2a; padding: 1.5rem; margin-bottom: 1.5rem; border-left: 4px solid #FF6B35;">
            <p style="line-height: 1.6; white-space: pre-wrap;">{{ disclaimer }}</p>
        </div>

        <div class="form-group">
            <label style="display: flex; align-items: start; gap: 0.75rem; cursor: pointer;">
                {{ form.disclaimer_confirmed }}
                <span style="flex: 1;">
                    {{ form.disclaimer_confirmed.label }}
                    {% if form.disclaimer_confirmed.errors %}
                        <ul class="errorlist">
                            {% for error in form.disclaimer_confirmed.errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </span>
            </label>
        </div>
    </div>
    {% endif %}

    {% if form.non_field_errors %}
        <ul class="errorlist" style="margin-bottom: 1rem;">
            {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <div style="margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap;">
        <button type="submit" class="btn">{% trans "Save Details" %}</button>
        <a href="{% url 'portal:payments:plan_list' fy_code=payment_plan.fiscal_year.code %}" class="btn btn-secondary">{% trans "Cancel" %}</a>
    </div>
</form>

{% endblock %}
