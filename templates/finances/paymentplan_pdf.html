{% extends "pdf/base.html" %}
{% load i18n static %}

{% block pdf_title %}{% trans "Standing invoice (Payment plan) No. " %} {{ pp.plan_code }} — {% trans "STAGE: " %} {{ pp.get_status_display }}{% endblock %}
{% block header_title %}{% trans "Fiscal year" %}{% endblock %}
{% block header_subtitle %}{% trans "Payment Plan" %} {{ pp.plan_code }}{% endblock %}
{% block footer_left %}© UniHanko — {{ now|date:"Y-m-d H:i" }}{% endblock %}

{% block extra_styles %} .sig-section { margin-top: 1mm; page-break-inside: avoid; } .sig-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4mm; } .sig-box { width: 100%; height: 28mm; border: 1px dashed #9aa3af;
border-radius: 4px; position: relative; background: #fff; } .sig-box .hint { position: absolute; top: 4px; left: 6px; font-size: 10px; color: #9aa3af; } .sig-meta { margin-top: 6px; font-size: 11px; color: #6b7280; }

.cert-footerbar {
    position: running(page-footer);
    font-size: 10px;
    color: #374151;
    border-top: 1px solid #ff8a3d;
    padding-top: 4mm;
    line-height: 1.3;
  }
{% endblock %}

{% block content %}
<h2 style="margin:0 0 8px 0;">{% trans "Receipt for standing invoice no. " %} <span style="color: var(--brand);">{{ pp.plan_code }}</span> <span style="color: var(--muted);">[{% trans "CC:" %} {{ pp.cost_center|default:"—" }}]</span></h2>
<h3 style="margin:10px 0 6px 0;">{% trans "Standing invoice status" %}</h3>
<table>
    <tbody>
        <tr>
            <th style="width:160px;">{% trans "Status" %}</th>
            <td>
                <span style="font-variant-caps: small-caps; font-weight: bold;">{{ pp.get_status_display }}</span>
            </td>
        </tr>
        <tr>
            <th>{% trans "Status notes" %}</th>
            <td>{{ pp.status_note }}</td>
        </tr>
        <tr>
            <th>{% trans "Signed by Functionary (Person)" %}</th>
            <td>
                {% if pp.signed_person_at %}
                    <span style="color:green; font-variant-caps: small-caps;">{% trans "Complete" %}</span>
                    <span>{{ pp.signed_person_at|date:"Y-m-d H:i" }}</span>
                {% else %}
                    <span style="color:red; font-variant-caps: small-caps;">{% trans "Pending" %}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>{% trans "Created at" %}</th>
            <td>{{ pp.created_at|date:"Y-m-d H:i" }}</td>
        </tr>
        <tr>
            <th>{% trans "Last updated" %}</th>
            <td>{{ pp.updated_at|date:"Y-m-d H:i" }}</td>
        </tr>
    </tbody>
</table>

<h3 style="margin:10px 0 6px 0;">{% trans "Standing invoice scope" %}</h3>
<table>
    <tbody>
        <tr>
            <th style="width:160px;">{% trans "Function (role assignment)" %}</th>
            <td>
                {{ pp.person_role }}
            </td>
        </tr>
        <tr>
            <th>{% trans "Start date" %}</th>
            <td>{{ pp.person_role.start_date|date:"j. F Y"|default:"—" }}</td>
        </tr>
        <tr>
            <th>{% trans "Effective start date" %}</th>
            <td>{{ pp.person_role.effective_start|date:"j. F Y"|default:"—" }}</td>
        </tr>
        <tr>
            <th>{% trans "End date (if applicable)" %}</th>
            <td>{{ pp.person_role.end_date|date:"j. F Y"|default:"—" }}</td>
        </tr>
        <tr>
            <th>{% trans "Effective end date (if applicable)" %}</th>
            <td>{{ pp.person_role.effective_end|date:"j. F Y"|default:"—" }}</td>
        </tr>
        <tr>
            <th>{% trans "Confirmation date (if applicable)" %}</th>
            <td>{{ pp.person_role.confirm_date|date:"j. F Y"|default:"—" }}</td>
        </tr>
        <tr>
            <th>{% trans "Confirmation reference (if applicable)" %}</th>
            <td>
                {% if pp.person_role.elected_via %}
                    {{ pp.person_role.elected_via.full_identifier }}
                {% else %}
                    —
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>{% trans "Assignment notes" %}</th>
            <td>{{ pp.person_role.notes|default:"No notes." }}</td>
        </tr>
    </tbody>
</table>

<h3 style="margin:10px 0 6px 0;">{% trans "Standing invoice banking information" %}</h3>
<table>
    <tbody>
        <tr>
            <th style="width:160px;">{% trans "Payee name" %}</th>
            <td>{{ pp.payee_name }}</td>
        </tr>
        <tr>
            <th>{% trans "Address" %}</th>
            <td>{{ pp.address }}</td>
        </tr>
        <tr>
            <th>IBAN</th>
            <td>{{ pp.iban_masked }}</td>
        </tr>
        <tr>
            <th>BIC/SWIFT</th>
            <td>{{ pp.bic }}</td>
        </tr>
        <tr>
            <th>{% trans "Banking reference" %}</th>
            <td>{{ pp.reference }}</td>
        </tr>
        <tr>
            <th>{% trans "Payment start date" %}</th>
            <td>{{ pp.pay_start|date:"j. F Y"|default:"—" }}</td>
        </tr>
        <tr>
            <th>{% trans "Payment end date" %}</th>
            <td>{{ pp.pay_end|date:"j. F Y"|default:"—" }}</td>
        </tr>
        <tr>
            <th>{% trans "Total amount" %}</th>
            <td>{{ pp.total_override }}</td>
        </tr>
        <tr>
            <th>{% trans "Monthly amount" %}</th>
            <td>{{ pp.monthly_amount }}</td>
        </tr>
    </tbody>
</table>

    <div class="cert-footerbar">
        <strong>{{ org.org_name_long_de }}</strong>
        {% if org.org_address %} • <u>{% trans "Adresse" %}</u> <i>({% trans "Zentralstelle im Büro Linz" %})</i>: {{ org.org_address }}{% endif %}
        {% if org.bank_name or org.bank_iban or org.bank_bic %}
        <br><u>Bank</u>: {% if org.bank_name %}{{ org.bank_name }}{% endif %}
        {% if org.bank_iban %} • IBAN: {{ org.bank_iban }}{% endif %}
        {% if org.bank_bic %} • BIC: {{ org.bank_bic }}{% endif %}
        {% endif %}
    </div>

{% block styles %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'hankosign/hs_seal.css' %}">
{% endblock %}

{% include "hankosign/_attestation_seal.html" with signatures=signatures %}

<h3 style="margin:6px 0 6px 0;">{% trans "Qualified Signature" %}</h3>
<div class="sig-section">
  <div class="sig-grid">
    <div class="sig-item">
      <div class="sig-box">
        <span style="font-size:1px;color:#fff">SIG_A_ANCHOR</span>
        <div class="hint">{% trans "Place electronic signature here" %}</div>
      </div>
      <div class="sig-meta">{% trans "Signer" %}: {% if pp.payee_name %}{{ pp.payee_name }}{% else %}{{ pp.person_role.person.first_name }} {{ pp.person_role.person.last_name }}{% endif %}</div>
    </div>
  </div>
</div>

<div style="color: (--muted)">
<h4 style="margin:14px 0 6px 0; text-align: center; font-size: 10px;">{% trans "Important notice" %}</h4>
<p style="font-size:6px; text-align: center;">
    {% trans "This document is confidential and intended solely for the named recipient. Any review, distribution or use by others is prohibited." %}
</p>
</div>
{% endblock %}
